//     eelnss.js
//     (c) 20014-2019 Pawel Cesar Sanjuan Szklarz
//     eelnss may be freely distributed under the MIT license.
!function(n){function e(n,e){if(!n)throw e||"Assertion failed"}var t=n._||require("underscore"),r=function(n,e,i){var u=function(e,t){return n(e,t)};return u.specification={valueSize:i||1},u.get=u,u.set=e,u.mod=function(t,r){return e(t(n(r)),r)},u.andThen=function(n){return r(t.compose(n,u),function(e,t){return u.mod(function(t){return n.set(e,t)},t)},u.specification.valueSize*n.specification.valueSize)},u.compose=function(n){return n.andThen(u)},u.eqClass=function(n){return{check:function(e){return void 0===n?!0:u.get(e)===n},select:function(e){return void 0===n?e:t.chain(e).filter(function(e){return u.get(e)===n}).value()},filter:function(e){return void 0===n?[]:t.chain(e).filter(function(e){return u.get(e)!==n}).value()}}},u},i=r(function(){return void 0},function(n,e){return e},0),u=r(function(n){return n},function(n){return n},1);u.andThen=function(n){return n};var c=function(n,i){function u(r){var u=i||{},c=u.fillEmpty||!1;if(t.isUndefined(r))return void 0;e(!t.isArray(r),"Arrays are not valid fieldLen containers. Field name:"+n+". Argument:"+r);var o=r[n];return c===!0&&t.isUndefined(o)?{}:o}function c(r,i){if(e(!t.isArray(i),"Arrays are not valid fieldLen containers. Field name:"+n+". Argument:"+i),t.isUndefined(r))return t.omit(i,n);var u={};return u[n]=r,t.chain(i).clone().extend(u).value()}return r(u,c,1)},o=function(n){e(t.isArray(n),"A list of lens is expected");var i=function(e){return t.map(n,function(n){return n.get(e)})},u=function(e,r){var i=e||t.range(n.length).map(function(){return void 0});return t.reduce(t.zip(n,i),function(n,e){var t=e[0],r=e[1];return t.set(r,n)},r)};return r(i,u,n.length)},a=function(n,i,u,c,o){var f=function(e,t){return n(e,t)};return f.specification={contextSize:c,valueSize:o,size:o+c},f.cget=n,f.cset=i,f.extract=u,f.lget=function(n){if(0===f.specification.contextSize)return[[f.cget([],n)]];var e=f.extract(n),r=t.chain(e).map(function(e){return t.chain(e).union([f.cget(e,n)]).flatten(!0).value()}).value();return r},f.lset=function(n,e){return 0===f.specification.contextSize&&0===n.length?f.cset([],void 0,e):t.chain(n).reduce(function(n,e){var t=e.slice(0,c),r=e.slice(c,f.specification.size);return 1===f.specification.valueSize?f.cset(t,r[0],n):f.cset(t,r,n)},e).value()},f.bindContext=function(t){e(t.length===c,"context size error");var u=function(e){return n(t,e)},o=function(n,e){return i(t,n,e)};return r(u,o,f.specification.valueSize)},f.bindContextValue=function(n){e(n.length===f.specification.size,"context size error");var t=n.slice(0,c),r=n.slice(c),i=f.bindContext(t);return{len:i,value:r,context:t}},f.mod=function(e,t,r){return i(e,t(n(e,r)),r)},f.cAndThen=function(e){function r(){var n=function(n,t){return e.cget(n,f.cget([],t))},t=function(n,t,r){return f.mod([],function(r){return e.cset(n,t,r)},r)},r=function(n){return e.extract(f.cget([],n))};return a(n,t,r,e.specification.contextSize,e.specification.valueSize)}function i(){var n=function(n,t){return e.cget([],f.cget(n,t))},t=function(n,t,r){return f.mod(n,function(n){return e.cset([],t,n)},r)};return a(n,t,f.extract,f.specification.contextSize,e.specification.valueSize)}function l(){var r=c+e.specification.contextSize,i=o*e.specification.valueSize,l=function(t,r){var i=t.slice(0,c),u=t.slice(c);return e(u,n(i,r))},s=function(n,t,r){var i=n.slice(0,c),u=n.slice(c);return f.mod(i,function(n){return e.cset(u,t,n)},r)},v=function(r){var i=u(r),c=t.chain(i).map(function(i){var u=e.extract(n(i,r));return t.map(u,function(n){return t.union(i,n)})}).flatten(!0).value();return c};return a(l,s,v,r,i)}return 0===c?r():0===e.specification.contextSize?i():l()},f.cCompose=function(n){return n.cAndThen(f)},f},f=function(n){return a(function(e,t){return n.get(t)},function(e,t,r){return n.set(t,r)},function(){return[[]]},0,n.specification.valueSize)},l=function(n){var r=n.fillEmpty||!1;return a(function(n,i){e(t.isArray(n),"context for map must be a single value"),e(1===n.length,"context for map must be a single value");var u=n[0],c=i[u];return r&&t.isUndefined(c)?{}:c},function(n,r,i){e(t.isArray(n),"context for map must be a single value"),e(1===n.length,"context for map must be a single value");var u=n[0];return i[u]=r,i},function(n){var e=t.keys(n);return 0===e.length?[]:t.chain(e).map(function(n){return[n]}).value()},1,1)},s=l({fillEmpty:!1}),v=l({fillEmpty:!0}),d=f(u);d.cAndThen=function(n){return n};// Part             := FieldLenPart | MapLenPart
// FieldLenPart     :=  fieldName::String
// MapLenPart       := '{' mapKeyName::String '}'
// TelescopePart    := '('  ( FieldLen ',') * ')'
// FieldLen         :=  (FieldLenPart '.')*
var p=function(n){var r,i=n.replace(/ /g,""),a=function(n,e){return n.cAndThen(e)},l=function(n,e){return n.andThen(e)},p=function(n,e){return f(c(n,{fillEmpty:!e}))},m=function(n,e){return e?s:v},g=function(n,r){e(r===!0," telescope parts must be at the end of the context len extression");var i=/\((.*)\)/gi.exec(n)[1],a=0==i.length?[]:i.split(","),s=function(n){return t.chain(n).map(function(e,t){var r=n.length-t-1===0;return c(e,{fillEmpty:!r})}).reduce(l,u).value()},v=t.chain(a).map(function(n){return n.split(".")}).map(s).value();return f(o(v))},h=i.indexOf("(");if(h==-1)r=i.split(".");else{var x=i.substring(0,h-1),z=i.substring(h);r=x.split("."),r.push(z)}var S=t.chain(r).map(function(n,e){var t=n.charAt(0),i=r.length-e-1===0;switch(t){case"(":return g(n,i);case"{":return m(n,i);default:return p(n,i)}}).reduce(a,d).value();return S.signature=i,S};t.mixin({lenDef:r,lenNil:i,lenIdentity:u,fieldLen:c,buildContextLen:p,telescope:o})}(this);
//# sourceMappingURL=eelnss-min.map